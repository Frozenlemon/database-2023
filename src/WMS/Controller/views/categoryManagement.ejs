<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href='css/cateM.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"
        integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT"
        crossorigin="anonymous"></script>

</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Lazada Admin</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav nav-pills nav-justified">
                <a class="nav-item nav-link" href="#">Warehouses</a>
                <a class="nav-item nav-link active" href="#">Inventory</a>
                <a class="nav-item nav-link" href="#">Category</a>
            </div>
        </div>
    </nav>

    <div class="search_form">
        <form class="example">
            <input type="text" placeholder="Search.." name="search">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
    </div>

    <div class="container">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <table class="table table-condensed table-hover" id='cateTable'>

                        <thead>
                            <tr class='header'>
                                <th>Name</th>
                                <th>Attribute</th>
                            </tr>
                        </thead>

                        <tbody id='category'>


                        </tbody>
                    </table>
                </div>

            </div>

        </div>
    </div>





    <script>
        async function getCate() {
            try {
                const requestOptions = {
                    method: 'GET'
                }
                const res = await fetch('/displayCate', requestOptions)
                return await res.json()

                if (!response.ok) {
                    throw new Error('Error fetching product data')
                }
            } catch (e) {

            }
        }



        async function renderDisplay() {
            const cateList = await getCate()
            const tableBody = document.getElementById('category')
            console.log(cateList)
            cateList.forEach(data => {
                const cateRow = document.createElement('tr')
                const childRow = document.createElement('tr')

                if (data.parentCate == null) {
                    const attribute = data.attribute
                    console.log(attribute)
                    cateRow.setAttribute('data-toggle', 'collapse')
                    cateRow.setAttribute('data-target', `#ChildAttr${data.id}`)
                    cateRow.setAttribute('class', 'accordion-toggle')

                    const cateName = document.createElement('td')
                    cateName.innerHTML = `${data.name}`

                    const cateAttribute = document.createElement('td')
                    const attributeList = document.createElement('ul')
                    cateAttribute.append(attributeList)
                    for (var key in attribute) {

                        const attrDetail = document.createElement("li")
                        attrDetail.innerHTML = key + `: ${attribute[key]}`
                        attributeList.append(attrDetail)
                    }

                    cateRow.append(cateName, cateAttribute)

                    const childRowData = document.createElement('td')
                    childRowData.setAttribute('colspan', '12')
                    childRowData.setAttribute('class', 'hiddenrow')

                    childRowDiv = document.createElement('div')
                    childRowDiv.id = `ChildAttr${data.id}`
                    childRowDiv.className = "accordian-body collapse"

                    const childTable = document.createElement('table')
                    childTable.className = "table table-hover"

                    const childHeader = document.createElement('thead')
                    const childBody = document.createElement('tbody')
                    childBody.id = `Table${data.id}`


                    const headerData = document.createElement('tr')

                    const headerSpace = document.createElement('th')
                    const headerName = document.createElement('th')
                    headerName.innerText = 'Name'
                    const headerAttr = document.createElement('th')
                    headerAttr.innerText = 'Attribute'


                    headerData.append(headerSpace, headerName, headerAttr)
                    childHeader.append(headerData)
                    childTable.append(childHeader, childBody)
                    childRowDiv.append(childTable)
                    childRowData.append(childRowDiv)
                    childRow.append(childRowData)
                    tableBody.append(cateRow, childRow)
                }
            }
            )
            cateList.forEach(data => {
                if (data.parentCate != null) {
                    const attribute = data.attribute
                    const itemlist = data.item
                    targetTable = document.getElementById(`Table${data.parentCate}`)
                    const cateRow = document.createElement('tr')
                    cateRow.setAttribute('data-toggle', 'collapse')
                    cateRow.setAttribute('data-target', `#ItemOf${data.id}`)
                    cateRow.setAttribute('class', 'accordion-toggle')

                    const space = document.createElement('td')
                    const cateName = document.createElement('td')
                    cateName.innerText = `${data.name}`

                    const cateAttribute = document.createElement('td')
                    const attributeList = document.createElement('ul')
                    cateAttribute.append(attributeList)
                    for (var key in attribute) {

                        const attrDetail = document.createElement("li")
                        attrDetail.innerHTML = key + `: ${attribute[key]}`
                        attributeList.append(attrDetail)
                    }
                    cateRow.append(space, cateName, cateAttribute)


                    // Init area for ItemList
                    const itemRow = document.createElement('tr')
                    const itemRowData = document.createElement('td')
                    itemRowData.setAttribute('colspan', '12')
                    itemRowData.setAttribute('class', 'hiddenrow')

                    itemRowDiv = document.createElement('div')
                    itemRowDiv.id = `ItemOf${data.id}`
                    itemRowDiv.className = "accordian-body collapse"

                    const itemTable = document.createElement('table')
                    itemTable.className = "table table-hover"

                    const itemHeader = document.createElement('thead')

                    const headerData = document.createElement('tr')

                    const headerSpace = document.createElement('th')
                    const headerName = document.createElement('th')
                    headerName.innerText = 'Item'
                    const headerBrand = document.createElement('th')
                    headerBrand.innerText = 'Brand'
                    const headerColor = document.createElement('th')
                    headerColor.innerText = 'Color'
                    const headerDimension = document.createElement('th')
                    headerDimension.innerText = 'Dimension'
                    const headerQuantity = document.createElement('th')
                    headerQuantity.innerText = 'Quantity'

                    headerData.append(headerSpace, headerName, headerBrand, headerColor, headerDimension, headerQuantity)
                    itemHeader.append(headerData)


                    const itemBody = document.createElement('tbody');

                    itemlist.forEach((item) => {
                        const itemData = document.createElement('tr')

                        const itemSpace = document.createElement('td')
                        const itemName = document.createElement('td')
                        itemName.innerText = `${item.name}`
                        const itemBrand = document.createElement('td')
                        itemBrand.innerText = `${item.brand}`
                        const itemColor = document.createElement('td')
                        itemColor.innerText = `${item.color}`
                        const itemDimension = document.createElement('td')
                        itemDimension.innerText = `${item.dimension}`
                        const itemQuantity = document.createElement('td')
                        itemQuantity.innerText = `${item.quantity}`

                        itemData.append(itemSpace, itemName, itemBrand, itemColor, itemDimension, itemQuantity)
                        itemBody.append(itemData)
                    });

                    itemTable.append(itemHeader, itemBody)
                    itemRowDiv.append(itemTable)
                    itemRowData.append(itemRowDiv)
                    itemRow.append(itemRowData)
                    targetTable.append(cateRow, itemRow)


                }
            }
            );
        }


        $(document).ready(() => {
            renderDisplay()
        })
    </script>



</body>

</html>